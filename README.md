# 🩸 血染钟楼 - 说书人助手 (Storyteller Helper)

这是一个基于 Web 的《血染钟楼》（Blood on the Clocktower）桌面游戏辅助工具，专为线下或线上游戏的说书人（主持人）设计。它旨在简化繁琐的游戏状态管理，让说书人能专注于营造氛围和叙述故事。

![Python](https://img.shields.io/badge/Python-3.8+-blue.svg)
![Flask](https://img.shields.io/badge/Backend-Flask-green.svg)
![Version](https://img.shields.io/badge/Version-v1.0.2+-blue.svg)
![Status](https://img.shields.io/badge/Status-Beta-orange.svg)

**当前版本**：v1.0.2-2-g9890b8e | **最后更新**：2026-01-05

## ✨ 核心功能

- **📖 剧本支持**：内置三大官方剧本（暗流涌动、黯月初升、梦殒春宵）。
- **🤖 自动化夜间流程**：
  - 自动生成正确的夜间唤醒顺序（不用再翻书查顺序了！）。
  - **智能信息生成**：自动计算洗衣妇、共情者、厨师、调查员等角色的查验信息，甚至考虑了**中毒/醉酒**的影响。
  - **复杂角色支持**：驱魔人、僵怖、沙巴洛斯、珀、恶魔代言人等复杂机制完整追踪。
  - 支持复杂的角色逻辑：如普卡（Pukka）的延迟击杀、旅店老板的醉酒保护等。
- **🗳️ 白天流程管理**：
  - 可视化的玩家座位表，直观显示存活/死亡状态。
  - 内置提名与投票计算器，自动判断处决结果。
  - 一键处理复活、死亡、更改状态。
- **🎭 沉浸式 UI**（v1.0.2+）：
  - WebGL 动态光照皮革背景效果，营造古老神秘的氛围。
  - 深色哥特风格界面，完美契合游戏主题。
  - **国际化完成**：所有代码和界面已完全中文化。

## 🚀 快速开始

### 环境要求

- Python 3.8 或更高版本

### 安装步骤

1. **克隆或下载本项目**到本地。
2. **安装依赖库**：
    打开终端（CMD 或 PowerShell），进入项目根目录，运行：

    ```bash
    pip install -r requirements.txt
    ```

### 启动游戏

1. **运行程序**：

    ```bash
    python main.py
    ```

2. **访问界面**：
    打开浏览器，访问地址：`http://127.0.0.1:5000`

---

## 📖 使用指南

### 1. 游戏设置 (Setup)

- **选择剧本**：点击卡片选择你要游玩的剧本。
- **设定人数**：拖动滑块选择玩家数量（5-15人）。
- **输入名字**：填写玩家昵称（建议按座位顺序）。
- **角色分配**：
  - 🎲 **随机分配**：系统根据官方规则（含男爵/教父等特殊规则）自动生成配置。
  - ✋ **手动分配**：如果您使用实体魔典抽完身份，可在此手动录入。

### 2. 夜间阶段 (Night)

- 系统会按顺序显示需要行动的角色。
- **操作**：根据提示选择目标。
- **自动结算**：对于“共情者”等信息类角色，系统会直接算出结果（如：“2个邪恶邻居”）。
- **标记状态**：系统会自动记录中毒、保护等状态。

### 3. 白天阶段 (Day)

- **圆桌界面**：点击玩家座位可查看详情、手动修改状态（中毒/醉酒）或直接杀死/复活玩家。
- **提名投票**：使用右下角的控制面板进行提名，系统会自动统计票数并告知是否处决成功。

---

## ⚠️ 注意事项

- **数据存储**：当前版本为**内存运行模式**。**请勿关闭运行 `main.py` 的终端窗口**，否则当前游戏进度会丢失。
- **单机运行**：本工具主要作为说书人的控制台使用，暂不支持多端联机（玩家端）。建议说书人在笔记本电脑或平板上操作。
- **刷新页面**：刷新浏览器页面通常不会丢失进度（只要后端没关），但建议谨慎操作。

## 🛠️ 技术栈

- **后端**: Python 3.8+ + Flask 2.3.0
- **前端**: 原生 HTML5/CSS3/JavaScript ES6+（无复杂框架依赖）
- **渲染引擎**: WebGL 2.0（背景特效）
- **字体**: Cinzel & Noto Serif SC
- **版本控制**: Git（线性提交历史，Rebase 工作流）

### 项目依赖

详见 `requirements.txt`：

```text
Flask==2.3.0
Werkzeug==2.3.0
```

---

## 📝 版本更新日志

### v1.0.2（当前版本 - 2026-01-05）

#### ✅ 新增功能

- **WebGL 动态光照背景**：实现了 2.5D 皮革纹理背景，带交互式光照效果
- **完整代码国际化**：所有 Python/JS/CSS 代码和注释完全汉化
- **复杂角色逻辑**：支持驱魔人、僵怖、沙巴洛斯、珀、恶魔代言人等高阶机制

#### 📦 技术改进

- 资源目录结构规范化（`static/images/textures/`）
- Git 提交历史线性整洁（Rebase 工作流验证）
- 主程序更新（+199 行代码）

#### 🚧 后续计划 (Phase 2 & 3)

- 木质层容器背景（金属边框）
- 羊皮纸内容层材质
- 移动端完整适配
- 游戏状态持久化

---

Enjoy your game! 🩸🕰️
